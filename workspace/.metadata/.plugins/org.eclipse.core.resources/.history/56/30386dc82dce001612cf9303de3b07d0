'''
Created on 30 Dec 2016

@author: 611370417
'''
import cx_Oracle


def make_Connection() :#
    try:
        conn = cx_Oracle.connect('sparkmaya/sparkmaya@127.0.0.1/XE')
        get_tables_metadata(conn)
        conn.close()
    except:
        print("Failed to connect to SparkMaya Master Database")


def get_tables_metadata(conn,connection_id=1):
    
    print 'Inside get_tables_metadata'
    cur = conn.cursor()
    connection = cur.execute('select * from connection_detail where id=%s' %(connection_id))    
      
    try:
        entryconn = cx_Oracle.connect(result[4],result[5],result[9])
        print "Connection Valid. Fetching table metadata"
        entrycurr = entryconn.cursor()
        resultset = entrycurr.execute("select table_name from dba_tables where owner=%s" %(result[6]))
        
        for result in resultset:
            print result
            
        entrycurr.close()
        entryconn.close()
            
    except cx_Oracle.DatabaseError, exception:
        print 'Error in get_table_metadata'
        prinfException(exception)
    
    
    
    

if __name__ == '__main__':
    make_Connection()