'''
Created on 29 Dec 2016

@author: 611370417
'''

import cx_Oracle

# connect to master database to fetch entries
def make_Connection() :#
    try:
        conn = cx_Oracle.connect('sparkmaya/sparkmaya@127.0.0.1/XE')
        valid_connection(conn)
        conn.close()
    except:
        printf("Failed to connect to SparkMaya Master Database")

# verify entries  
def valid_connection(conn):
    cur = conn.cursor()
    
    # Fetch entries
    connection = cur.execute('select * from connection_detail where valid_connection=0 and database_type=1')
    
    # Sample Entry : (1, 1, '127.0.0.1', 1521, 'SPARKMAYA', 'sparkmaya', 'SPARKMAYA', 'XE_Connection_Local', '0', 'XE')
    
    
    for result in connection:
        printf("Validating entry for connection %s\n", result[7])       
        try:
            entryconn = cx_Oracle.connect(result[4],result[5],result[9])
            printf ("Connection Valid")
        except cx_Oracle.DatabaseError, exception:
            prinfException(exception)
        
        printf("Connection Valid..")
        for result in cur:
            print "Updating %s wth valid_conection=1" %(result[7])
            cur.execute("update connection_detail set valid_connection=1 where id=%s" %(result[0]))
            print result
    
    con.commit()
    cur.close()
    




if __name__ == '__main__':
    make_Connection()